{% extends "layout.njk" %}

{% block title %}{{ title }} - Kainos{% endblock %}

{% block content %}
<script src="/js/job-filters.js"></script>

<div class="w-full max-w-7xl mx-auto">
  <!-- Page Header with DaisyUI -->
  <div class="flex flex-col lg:flex-row justify-between items-center mb-6 gap-4">
    <div class="flex-1 text-center lg:text-left">
      <h1 class="text-5xl font-bold kainos-text-gradient">{{ title }}</h1>
      <p class="text-lg text-base-content/70 mt-2">Discover exciting career opportunities at Kainos</p>
    </div>
    <div class="flex flex-col sm:flex-row gap-2">
      <a href="/jobs/new" class="btn-kainos shadow-lg hover:shadow-xl inline-flex items-center gap-2">
        <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor">
          <path fill-rule="evenodd" d="M10 3a1 1 0 011 1v5h5a1 1 0 110 2h-5v5a1 1 0 11-2 0v-5H4a1 1 0 110-2h5V4a1 1 0 011-1z" clip-rule="evenodd" />
        </svg>
        Add New Job Role
      </a>
      <a href="/jobs/report" class="btn-kainos-outline shadow-lg hover:shadow-xl inline-flex items-center gap-2">
        <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor">
          <path fill-rule="evenodd" d="M3 17a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1zm3.293-7.707a1 1 0 011.414 0L9 10.586V3a1 1 0 112 0v7.586l1.293-1.293a1 1 0 111.414 1.414l-3 3a1 1 0 01-1.414 0l-3-3a1 1 0 010-1.414z" clip-rule="evenodd" />
        </svg>
        Report
      </a>
    </div>
  </div>

  <!-- Filter Panel with DaisyUI Card -->
  <div class="card bg-base-100 shadow-xl mb-8">
    <div class="card-body">
      <div class="flex flex-col lg:flex-row justify-between items-start lg:items-center mb-6 gap-4">
        <div>
          <h2 class="card-title text-3xl text-kainos-primary">Filter Job Roles</h2>
          <p class="text-base-content/70">Refine your search to find the perfect opportunity (filters apply automatically)</p>
        </div>
        <button onclick="clearFilters()" class="btn-kainos-outline shadow-lg hover:shadow-xl inline-flex items-center gap-2">
          <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
          </svg>
          Clear All
        </button>
      </div>

      <div class="divider"></div>

      <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6">
        <!-- Name Filter -->
        <div class="form-control">
          <label class="label">
            <span class="label-text font-semibold">Job Name</span>
          </label>
          <label class="input input-bordered flex items-center gap-2">
            <svg class="h-4 w-4 opacity-70" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"></path>
            </svg>
            <input 
              type="text" 
              id="nameFilter" 
              placeholder="Search by job name..." 
              value="{{ currentFilters.name or '' }}"
              class="grow"
            />
          </label>
        </div>

        <!-- Location Filter -->
        <div class="form-control">
          <label class="label">
            <span class="label-text font-semibold">Location</span>
          </label>
          <select id="locationFilter" class="select select-bordered w-full">
            <option value="">All Locations</option>
            {% for loc in distinctValues.locations %}
            <option value="{{ loc }}" {% if currentFilters.location and (currentFilters.location.includes(loc)) %}selected{% endif %}>
              {{ loc }}
            </option>
            {% endfor %}
          </select>
        </div>

        <!-- Capability Filter -->
        <div class="form-control">
          <label class="label">
            <span class="label-text font-semibold">Capability</span>
          </label>
          <select id="capabilityFilter" class="select select-bordered w-full">
            <option value="">All Capabilities</option>
            {% for cap in distinctValues.capabilities %}
            <option value="{{ cap }}" {% if currentFilters.capability and (currentFilters.capability.includes(cap)) %}selected{% endif %}>
              {{ cap }}
            </option>
            {% endfor %}
          </select>
        </div>

        <!-- Band Filter -->
        <div class="form-control">
          <label class="label">
            <span class="label-text font-semibold">Band</span>
          </label>
          <select id="bandFilter" class="select select-bordered w-full">
            <option value="">All Bands</option>
            {% for b in distinctValues.bands %}
            <option value="{{ b }}" {% if currentFilters.band and (currentFilters.band.includes(b)) %}selected{% endif %}>
              {{ b }}
            </option>
            {% endfor %}
          </select>
        </div>
      </div>

      <div class="divider">Sort Options</div>

      <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
        <!-- Sort By Filter -->
        <div class="form-control">
          <label class="label">
            <span class="label-text font-semibold">Sort By</span>
          </label>
          <select id="sortByFilter" class="select select-bordered w-full">
            <option value="">No Sorting</option>
            <option value="name" {% if currentSort.sortBy == 'name' %}selected{% endif %}>Job Name</option>
            <option value="location" {% if currentSort.sortBy == 'location' %}selected{% endif %}>Location</option>
            <option value="capability" {% if currentSort.sortBy == 'capability' %}selected{% endif %}>Capability</option>
            <option value="band" {% if currentSort.sortBy == 'band' %}selected{% endif %}>Band</option>
          </select>
        </div>

        <!-- Sort Order Filter -->
        <div class="form-control">
          <label class="label">
            <span class="label-text font-semibold">Sort Order</span>
          </label>
          <select id="sortOrderFilter" class="select select-bordered w-full">
            <option value="asc" {% if currentSort.sortOrder == 'asc' %}selected{% endif %}>Ascending (A-Z)</option>
            <option value="desc" {% if currentSort.sortOrder == 'desc' %}selected{% endif %}>Descending (Z-A)</option>
          </select>
        </div>
      </div>
    </div>
  </div>

  <!-- Results Count with Stats -->
  <div class="stats shadow mb-6 w-full bg-base-100">
    <div class="stat">
      <div class="stat-figure text-primary">
        <svg class="h-8 w-8" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5H7a2 2 0 00-2 2v10a2 2 0 002 2h8a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2"></path>
        </svg>
      </div>
      <div class="stat-title">Available Positions</div>
      <div class="stat-value text-primary">{{ pagination.totalResults }}</div>
      <div class="stat-desc">Showing {{ jobRoles.length }} of {{ pagination.totalResults }} results (Page {{ pagination.currentPage }} of {{ pagination.totalPages }})</div>
    </div>
  </div>

  {% if jobRoles.length > 0 %}
    <!-- Table with DaisyUI -->
    <div class="card bg-base-100 shadow-xl">
      <div class="overflow-x-auto">
        <table class="table table-zebra">
          <thead>
            <tr>
              <th>Job Name</th>
              <th>Location</th>
              <th>Capability</th>
              <th>Band</th>
              <th>Actions</th>
            </tr>
          </thead>
          <tbody>
            {% for job in jobRoles %}
            <tr class="hover">
              <td class="font-medium">{{ job.name }}</td>
              <td>{{ job.location }}</td>
              <td>{{ job.capability }}</td>
              <td>{{ job.band }}</td>
              <td>
                <a href="/jobs/{{ job.id }}/details" class="btn-kainos shadow-md hover:shadow-lg inline-flex items-center gap-2 text-sm px-4 py-2">
                  <span>View Details</span>
                </a>
              </td>
            </tr>
            {% endfor %}
          </tbody>
        </table>
      </div>
    </div>

    <!-- Pagination Controls -->
    {% if pagination.totalPages > 1 %}
    <div class="flex justify-center items-center gap-4 mt-6">
      <div class="join">
        {% if pagination.hasPrevPage %}
        <a href="?page={{ pagination.currentPage - 1 }}&limit={{ pagination.limit }}{% if currentFilters.name %}&name={{ currentFilters.name }}{% endif %}{% for loc in currentFilters.location %}&location={{ loc }}{% endfor %}{% for cap in currentFilters.capability %}&capability={{ cap }}{% endfor %}{% for b in currentFilters.band %}&band={{ b }}{% endfor %}{% if currentSort.sortBy %}&sortBy={{ currentSort.sortBy }}&sortOrder={{ currentSort.sortOrder }}{% endif %}" 
           class="join-item btn btn-outline">
          <svg class="h-5 w-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"></path>
          </svg>
          Previous
        </a>
        {% else %}
        <button class="join-item btn btn-outline btn-disabled" disabled>
          <svg class="h-5 w-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"></path>
          </svg>
          Previous
        </button>
        {% endif %}

        <button class="join-item btn btn-outline no-animation">
          Page {{ pagination.currentPage }} of {{ pagination.totalPages }}
        </button>

        {% if pagination.hasNextPage %}
        <a href="?page={{ pagination.currentPage + 1 }}&limit={{ pagination.limit }}{% if currentFilters.name %}&name={{ currentFilters.name }}{% endif %}{% for loc in currentFilters.location %}&location={{ loc }}{% endfor %}{% for cap in currentFilters.capability %}&capability={{ cap }}{% endfor %}{% for b in currentFilters.band %}&band={{ b }}{% endfor %}{% if currentSort.sortBy %}&sortBy={{ currentSort.sortBy }}&sortOrder={{ currentSort.sortOrder }}{% endif %}" 
           class="join-item btn btn-outline">
          Next
          <svg class="h-5 w-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"></path>
          </svg>
        </a>
        {% else %}
        <button class="join-item btn btn-outline btn-disabled" disabled>
          Next
          <svg class="h-5 w-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"></path>
          </svg>
        </button>
        {% endif %}
      </div>
    </div>
    {% endif %}
  {% else %}
    <div role="alert" class="alert alert-info">
      <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" class="stroke-current shrink-0 w-6 h-6">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path>
      </svg>
      <span>No job roles found matching your criteria.</span>
    </div>
  {% endif %}

  <!-- Back Button -->
  <div class="mt-8 flex justify-center">
    <a href="/" class="btn btn-outline btn-primary gap-2">
      <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor">
        <path fill-rule="evenodd" d="M9.707 16.707a1 1 0 01-1.414 0l-6-6a1 1 0 010-1.414l6-6a1 1 0 011.414 1.414L5.414 9H17a1 1 0 110 2H5.414l4.293 4.293a1 1 0 010 1.414z" clip-rule="evenodd" />
      </svg>
      Back to Home
    </a>
  </div>
</div>
{% endblock %}